#!/usr/bin/env ruby
require 'pathname'

# path to your application root.
APP_ROOT = Pathname.new File.expand_path('../../',  __FILE__)

Dir.chdir APP_ROOT do
  # This script is a starting point to setup your application.
  # Add necessary setup steps to this file:

  puts "== Creating Docker images =="
  system "docker build -t pokesite #{APP_ROOT}"
  system "docker stop pokesite-{dev,test}{,-db}"
  system "docker rm pokesite-{dev,test}{,-db}"
  system "docker create -P --name pokesite-dev-db --volume #{APP_ROOT}/db/neo4j/development/data/graph.db:/var/lib/neo4j/data/graph.db tpires/neo4j"
  system "docker create -P --name pokesite-test-db --volume #{APP_ROOT}/db/neo4j/test/data/graph.db:/var/lib/neo4j/data/graph.db tpires/neo4j"
  system "docker create -i -t -P --name pokesite-dev --link pokesite-dev-db:db --volume #{APP_ROOT}:/usr/src/app pokesite bin/rails s -b 0.0.0.0"
  system "docker create -i -t --name pokesite-test --link pokesite-test-db:db --volumes-from pokesite-dev pokesite bin/rspec"
end
