#!/usr/bin/env ruby
require 'pathname'

# path to your application root.
APP_ROOT = Pathname.new File.expand_path('../../',  __FILE__)

Dir.chdir APP_ROOT do
  # This script is a starting point to setup your application.
  # Add necessary setup steps to this file:

  puts "== Creating Docker images =="
  system "docker build -t pokesite #{APP_ROOT}"
  system "docker stop pokesite-dev"
  system "docker stop pokesite-dev-db"
  system "docker stop pokesite-test-db"
  system "docker rm pokesite-dev"
  system "docker rm pokesite-dev-db"
  system "docker rm pokesite-test-db"
  system "docker create -p 48461:7474 -e 'NEO4J_NO_AUTH=1' --name pokesite-dev-db --volume #{APP_ROOT}/db/neo4j/development/data:/data neo4j/neo4j:stable"
  system "docker create -p 48462:7474 -e 'NEO4J_NO_AUTH=1' --name pokesite-test-db --volume #{APP_ROOT}/db/neo4j/test/data:/data neo4j/neo4j:stable"
  system "docker create -i -t -p 48460:3000 --name pokesite-dev --link pokesite-dev-db:db --volume #{APP_ROOT}:/usr/src/app pokesite bin/rails s -b 0.0.0.0"
end
